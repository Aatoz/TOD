<!DOCTYPE html>
<html>
<head>
	<title>Testimony of the Day</title>
	<meta charset="UTF-8">
	<meta http-equiv="Cache-control" content="public">
	<meta name="viewport" content="width=device-width, initial-scale=1">

	<link rel="stylesheet" href="https://www.w3schools.com/w3css/4/w3.css">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Raleway">

	<!-- Bootstrap core CSS -->
	<link href="bootstrap.min.css" rel="stylesheet">
	<link href="jasny-bootstrap.min.css" rel="stylesheet">

	<!-- Custom styles for this template -->
	<link href="navmenu.css" rel="stylesheet">
	<link href="generic.css" rel="stylesheet">
	<link rel="stylesheet" href="theme-dark.css" rel="stylesheet" id="theme-css"> 
	<link rel="stylesheet" href="https://www.w3schools.com/lib/w3-theme-black.css" id="w3-theme-css">

	<!-- Chrome, Firefox OS and Opera -->
	<meta name="theme-color" content="#0000ff">
	<!-- Windows Phone -->
	<meta name="msapplication-navbutton-color" content="#4285f4">
	<!-- iOS Safari -->
	<meta name="apple-mobile-web-app-status-bar-style" content="#4285f4">
</head>
<body>
<button id="button" onclick="doSearch()">Click Me</button>


<script>
var xhr = function() {
    var xhr = new XMLHttpRequest();
    return function( method, url, callback ) {
        xhr.onreadystatechange = function() {
            if ( xhr.readyState == 4 ) {
                callback( xhr.responseText );
            }
        };
        xhr.open( method, url , false);
        xhr.send();
    };
}();


var g_bLoop = true;
var g_bFoundAnyFile = false;
function doSearch(vEvent) {

	var vDate = new Date();
	var vDayOfMonth = vDate.getDate();
	vDate.setDate(vDayOfMonth + 1);

	for (var iDay = 0; iDay < 15; ++iDay) // try as fr back as 15 years worth of data -- that'll hold for awhile! 5475
	{
		// Decrement days that we load.
		vDayOfMonth = vDate.getDate();
		vDate.setDate(vDayOfMonth - 1);
		var sDateStr = (vDate.getMonth() + 1) + '-' + vDate.getDate() + '-' +  vDate.getFullYear();
		console.log(sDateStr);

		xhr("get", "https://rawgit.com/Aatoz/TOD/master/" + sDateStr + ".xml", function(data) {

			console.log("Data: " + data);
			if (data.length === 0 || data.indexOf("404: Not Found") > -1)
			{
				g_bLoop = !g_bFoundAnyFile;
				if (!g_bLoop)
					console.log("Done looping");
			}
			else
			{
				console.log("Found file");
				g_bFoundAnyFile = true;
			}
		});

		if (!g_bLoop)
			break;
	}

	console.log("Done");

}

function transferFailed(vEvent) {
	window.alert("fail");
	console.log("Failed: " + vEvent);
	g_bLoop = !g_bFoundAnyFile;
}

function doTest(vHTTP) {
	var vDate = new Date();

	// Load the last 5 days
	for (var iCnt = 0; iCnt < 5; iCnt++)
	{
		var xhttp;
		if (window.XMLHttpRequest) {
			// code for modern browsers
			xhttp = new XMLHttpRequest();
			} else {
			// code for IE6, IE5
			xhttp = new ActiveXObject("Microsoft.XMLHTTP");
		}

		xhttp.addEventListener("error", transferFailed);
		xhttp.addEventListener("load", transferComplete);
		//xhttp.responseType = 'document';
		//xhttp.overrideMimeType('text/xml');

		xhttp.onreadystatechange = function() {
			if (this.readyState == 4 && this.status == 200) {
				parseXML(this);
			}
		};

		//  Decrement days that we load.
		var vDayOfMonth = vDate.getDate();
		vDate.setDate(vDayOfMonth - 1);

		var sDateStr = (vDate.getMonth() + 1) + '-' + vDate.getDate() + '-' +  vDate.getFullYear();

		xhttp.open('GET', 'https://rawgit.com/Aatoz/TOD/master/' + sDateStr + '.xml', true);
		console.log(sDateStr);
		xhttp.send();
	}
}

function transferFailed(evt) {
	window.alert("An error occurred while transferring the file.");
}

function transferComplete(evt) {
	//window.alert("The transfer is complete." + event.returnValue);
}
</script>
</body>
</html>